{"version":3,"sources":["../../src/router/router.js"],"names":["route","koaBody","require","method","isAsync","target","name","descriptor","setTimeout","prefix","router","fixed_route","console","log","getDefaultHttpMethod","next","value","call","params","result","body","status","test"],"mappings":";;;;;;;;;;QAUgBA,K,GAAAA,K;;AAPhB;;;;;;2cAHA;;;;;AAIA,IAAMC,UAAUC,QAAQ,UAAR,CAAhB;AACA;;;;;AAKO,SAASF,KAAT,CAAeA,KAAf,EAAsBG,MAAtB,EAA8C;AAAA,KAAhBC,OAAgB,uEAAN,IAAM;;AACpD,QAAO,UAASC,MAAT,EAAiBC,IAAjB,EAAuBC,UAAvB,EAAmC;AACzCC,aAAW,YAAW;AAAE;AACvB,OAAIC,SAASJ,OAAOK,MAAP,IAAiBL,OAAOK,MAAP,CAAcD,MAA5C;AAAA,OACCE,WADD;AAEA,OAAIX,KAAJ,EAAW;AACVW,kBAAcF,eAAaA,MAAb,SAAuBT,KAAvB,SAAqCA,KAAnD;AACA,IAFD,MAEO;AACNW,wBAAkBF,MAAlB;AACA;;AAEDG,WAAQC,GAAR,CAAYF,WAAZ;AACAR,YAASA,UAAUW,qBAAqBR,IAArB,EAA2BN,KAA3B,CAAV,IAA+C,KAAxD;AACA,uBAAUG,MAAV,EAAkBQ,WAAlB,EAA8BV,SAA9B;AAAA,0EAAyC,iBAAec,IAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA,eAGnCZ,WAAW,KAAX,IAAoBA,WAAW,QAHI;AAAA;AAAA;AAAA;;AAAA,cAIlCC,OAJkC;AAAA;AAAA;AAAA;;AAAA;AAAA,gBAKtBG,WAAWS,KAAX,CAAiBC,IAAjB,CAAsBZ,MAAtB,EAA8B,KAAKa,MAAnC,EAA0C,IAA1C,CALsB;;AAAA;AAKrCC,eALqC;AAAA;AAAA;;AAAA;AAOrCA,kBAASZ,WAAWS,KAAX,CAAiBC,IAAjB,CAAsBZ,MAAtB,EAA8B,KAAKa,MAAnC,EAA0C,IAA1C,CAAT;;AAPqC;AAAA;AAAA;;AAAA;AAAA,cAUhBd,OAVgB;AAAA;AAAA;AAAA;;AAAA;AAAA,gBAWtBG,WAAWS,KAAX,CAAiBC,IAAjB,CAAsBZ,MAAtB,EAA6B,KAAKe,IAAlC,EAAuC,IAAvC,CAXsB;;AAAA;AAWrCD,eAXqC;AAAA;AAAA;;AAAA;AAarCA,kBAASZ,WAAWS,KAAX,CAAiBC,IAAjB,CAAsBZ,MAAtB,EAA8B,KAAKe,IAAnC,EAAwC,IAAxC,CAAT;;AAbqC;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAkBvCR,iBAAQC,GAAR;AACA,cAAKQ,MAAL,GAAc,GAAd;;AAnBuC;;AAsBxC,cAAKD,IAAL,GAAYD,MAAZ;AAtBwC;AAAA,gBAuBlCJ,IAvBkC;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAzC;;AAAA;AAAA;AAAA;AAAA;AAyBA,UAAOR,UAAP;AACA,GArCD;AAsCA,EAvCD;AAyCA;;AAED,SAASO,oBAAT,CAA8BR,IAA9B,EAAoCN,KAApC,EAA2C;AAC1C,KAAI,OAAOsB,IAAP,CAAYhB,IAAZ,CAAJ,EAAuB;AACtB,SAAO,KAAP;AACA,EAFD,MAEO,IAAI,UAAUgB,IAAV,CAAehB,IAAf,CAAJ,EAA0B;AAChC,SAAO,KAAP;AACA,EAFM,MAEA,IAAI,UAAUgB,IAAV,CAAehB,IAAf,KAAwB,UAAUgB,IAAV,CAAehB,IAAf,CAA5B,EAAkD;AACxD,SAAO,QAAP;AACA,EAFM,MAEA,IAAI,UAAUgB,IAAV,CAAehB,IAAf,CAAJ,EAA0B;AAChC,SAAO,KAAP;AACA,EAFM,MAEA,IAAI,QAAQgB,IAAR,CAAahB,IAAb,CAAJ,EAAwB;AAC9B,SAAO,MAAP;AACA,EAFM,MAEA,IAAIN,KAAJ,EAAW;AACjB,SAAOc,qBAAqBd,KAArB,CAAP;AACA;AACD","file":"router.js","sourcesContent":["/**\n * Created by yao on 2017/6/12.\n */\nimport koaRouter from \"./koa-router\";\nconst koaBody = require('koa-body');\n/**\n * @param  {} route\n * @param  {} method\n * @param  {} isAsync=true\n */\nexport function route(route, method, isAsync = true) {\n\treturn function(target, name, descriptor) {\n\t\tsetTimeout(function() { //TODO：默认类的实例化会在函数实例化之后，所有这里会加这个东东\n\t\t\tvar prefix = target.router && target.router.prefix,\n\t\t\t\tfixed_route;\n\t\t\tif (route) {\n\t\t\t\tfixed_route = prefix ? `/${prefix}/${route}` : `/${route}`;\n\t\t\t} else {\n\t\t\t\tfixed_route = `/${prefix}`;\n\t\t\t}\n\n\t\t\tconsole.log(fixed_route);\n\t\t\tmethod = method || getDefaultHttpMethod(name, route) || 'get';\n\t\t\tkoaRouter[method](fixed_route,koaBody(), async function(next) {\n\t\t\t\tvar result;\n\t\t\t\ttry {\n\t\t\t\t\tif (method === 'get' || method === 'delete') {\n\t\t\t\t\t\tif (isAsync) {\n\t\t\t\t\t\t\tresult = await descriptor.value.call(target, this.params,this);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tresult = descriptor.value.call(target, this.params,this);\n\t\t\t\t\t\t}\n\t\t\t\t\t}else{\n                        if (isAsync) {\n\t\t\t\t\t\t\tresult = await descriptor.value.call(target,this.body,this);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tresult = descriptor.value.call(target, this.body,this);\n\t\t\t\t\t\t}\n                    }\n\n\t\t\t\t} catch (error) {\n\t\t\t\t\tconsole.log(error);\n\t\t\t\t\tthis.status = 500;\n\t\t\t\t}\n\n\t\t\t\tthis.body = result;\n\t\t\t\tawait next;\n\t\t\t});\n\t\t\treturn descriptor;\n\t\t});\n\t}\n\n}\n\nfunction getDefaultHttpMethod(name, route) {\n\tif (/^get/.test(name)) {\n\t\treturn 'get';\n\t} else if (/^update/.test(name)) {\n\t\treturn 'put';\n\t} else if (/^delete/.test(name) || /^remove/.test(name)) {\n\t\treturn 'delete';\n\t} else if (/^create/.test(name)) {\n\t\treturn 'get';\n\t} else if (/^save/.test(name)) {\n\t\treturn 'post';\n\t} else if (route) {\n\t\treturn getDefaultHttpMethod(route);\n\t}\n}\n"]}