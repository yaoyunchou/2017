{"version":3,"sources":["../../src/router/router.js"],"names":["route","method","isAsync","target","name","descriptor","setTimeout","prefix","router","fixed_route","console","log","getDefaultHttpMethod","next","value","call","params","result","body","status","test"],"mappings":";;;;;;;;;;QASgBA,K,GAAAA,K;;AANhB;;;;;;2cAHA;;;;;AAIA;;;;;AAKO,SAASA,KAAT,CAAeA,KAAf,EAAsBC,MAAtB,EAA8C;AAAA,KAAhBC,OAAgB,uEAAN,IAAM;;AACpD,QAAO,UAASC,MAAT,EAAiBC,IAAjB,EAAuBC,UAAvB,EAAmC;AACzCC,aAAW,YAAW;AAAE;AACvB,OAAIC,SAASJ,OAAOK,MAAP,IAAiBL,OAAOK,MAAP,CAAcD,MAA5C;AAAA,OACCE,WADD;AAEA,OAAIT,KAAJ,EAAW;AACVS,kBAAcF,eAAaA,MAAb,SAAuBP,KAAvB,SAAqCA,KAAnD;AACA,IAFD,MAEO;AACNS,wBAAkBF,MAAlB;AACA;;AAEDG,WAAQC,GAAR,CAAYF,WAAZ;AACAR,YAASA,UAAUW,qBAAqBR,IAArB,EAA2BJ,KAA3B,CAAV,IAA+C,KAAxD;AACA,uBAAUC,MAAV,EAAkBQ,WAAlB;AAAA,4DAA+B,iBAAeI,IAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA,eAGzBZ,WAAW,KAAX,IAAoBA,WAAW,QAHN;AAAA;AAAA;AAAA;;AAAA,cAIxBC,OAJwB;AAAA;AAAA;AAAA;;AAAA;AAAA,gBAKZG,WAAWS,KAAX,CAAiBC,IAAjB,CAAsBZ,MAAtB,EAA8B,KAAKa,MAAnC,EAA0C,IAA1C,CALY;;AAAA;AAK3BC,eAL2B;AAAA;AAAA;;AAAA;AAO3BA,kBAASZ,WAAWS,KAAX,CAAiBC,IAAjB,CAAsBZ,MAAtB,EAA8B,KAAKa,MAAnC,EAA0C,IAA1C,CAAT;;AAP2B;AAAA;AAAA;;AAAA;AAAA,cAUNd,OAVM;AAAA;AAAA;AAAA;;AAAA;AAAA,gBAWZG,WAAWS,KAAX,CAAiBC,IAAjB,CAAsBZ,MAAtB,EAA8B,KAAKe,IAAnC,EAAwC,IAAxC,CAXY;;AAAA;AAW3BD,eAX2B;AAAA;AAAA;;AAAA;AAa3BA,kBAASZ,WAAWS,KAAX,CAAiBC,IAAjB,CAAsBZ,MAAtB,EAA8B,KAAKe,IAAnC,EAAwC,IAAxC,CAAT;;AAb2B;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAkB7BR,iBAAQC,GAAR;AACA,cAAKQ,MAAL,GAAc,GAAd;;AAnB6B;;AAsB9B,cAAKD,IAAL,GAAYD,MAAZ;AAtB8B;AAAA,gBAuBxBJ,IAvBwB;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAA/B;;AAAA;AAAA;AAAA;AAAA;AAyBA,UAAOR,UAAP;AACA,GArCD;AAsCA,EAvCD;AAyCA;;AAED,SAASO,oBAAT,CAA8BR,IAA9B,EAAoCJ,KAApC,EAA2C;AAC1C,KAAI,OAAOoB,IAAP,CAAYhB,IAAZ,CAAJ,EAAuB;AACtB,SAAO,KAAP;AACA,EAFD,MAEO,IAAI,UAAUgB,IAAV,CAAehB,IAAf,CAAJ,EAA0B;AAChC,SAAO,KAAP;AACA,EAFM,MAEA,IAAI,UAAUgB,IAAV,CAAehB,IAAf,KAAwB,UAAUgB,IAAV,CAAehB,IAAf,CAA5B,EAAkD;AACxD,SAAO,QAAP;AACA,EAFM,MAEA,IAAI,UAAUgB,IAAV,CAAehB,IAAf,CAAJ,EAA0B;AAChC,SAAO,KAAP;AACA,EAFM,MAEA,IAAI,QAAQgB,IAAR,CAAahB,IAAb,CAAJ,EAAwB;AAC9B,SAAO,MAAP;AACA,EAFM,MAEA,IAAIJ,KAAJ,EAAW;AACjB,SAAOY,qBAAqBZ,KAArB,CAAP;AACA;AACD","file":"router.js","sourcesContent":["/**\r\n * Created by yao on 2017/6/12.\r\n */\r\nimport koaRouter from \"./koa-router\";\r\n/**\r\n * @param  {} route\r\n * @param  {} method\r\n * @param  {} isAsync=true\r\n */\r\nexport function route(route, method, isAsync = true) {\r\n\treturn function(target, name, descriptor) {\r\n\t\tsetTimeout(function() { //TODO：默认类的实例化会在函数实例化之后，所有这里会加这个东东\r\n\t\t\tvar prefix = target.router && target.router.prefix,\r\n\t\t\t\tfixed_route;\r\n\t\t\tif (route) {\r\n\t\t\t\tfixed_route = prefix ? `/${prefix}/${route}` : `/${route}`;\r\n\t\t\t} else {\r\n\t\t\t\tfixed_route = `/${prefix}`;\r\n\t\t\t}\r\n\r\n\t\t\tconsole.log(fixed_route);\r\n\t\t\tmethod = method || getDefaultHttpMethod(name, route) || 'get';\r\n\t\t\tkoaRouter[method](fixed_route, async function(next) {\r\n\t\t\t\tvar result;\r\n\t\t\t\ttry {\r\n\t\t\t\t\tif (method === 'get' || method === 'delete') {\r\n\t\t\t\t\t\tif (isAsync) {\r\n\t\t\t\t\t\t\tresult = await descriptor.value.call(target, this.params,this);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tresult = descriptor.value.call(target, this.params,this);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}else{\r\n                        if (isAsync) {\r\n\t\t\t\t\t\t\tresult = await descriptor.value.call(target, this.body,this);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tresult = descriptor.value.call(target, this.body,this);\r\n\t\t\t\t\t\t}\r\n                    }\r\n\r\n\t\t\t\t} catch (error) {\r\n\t\t\t\t\tconsole.log(error);\r\n\t\t\t\t\tthis.status = 500;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.body = result;\r\n\t\t\t\tawait next;\r\n\t\t\t});\r\n\t\t\treturn descriptor;\r\n\t\t});\r\n\t}\r\n\r\n}\r\n\r\nfunction getDefaultHttpMethod(name, route) {\r\n\tif (/^get/.test(name)) {\r\n\t\treturn 'get';\r\n\t} else if (/^update/.test(name)) {\r\n\t\treturn 'put';\r\n\t} else if (/^delete/.test(name) || /^remove/.test(name)) {\r\n\t\treturn 'delete';\r\n\t} else if (/^create/.test(name)) {\r\n\t\treturn 'get';\r\n\t} else if (/^save/.test(name)) {\r\n\t\treturn 'post';\r\n\t} else if (route) {\r\n\t\treturn getDefaultHttpMethod(route);\r\n\t}\r\n}\r\n"]}