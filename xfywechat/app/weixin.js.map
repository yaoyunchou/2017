{"version":3,"sources":["../src/weixin.js"],"names":["config","require","Wechat","wechatApi","wechat","exports","reply","next","message","weixin","MsgType","Event","EventKey","console","log","ticket","body","latitude","longitude","Precision","Ticket","Location_X","Location_Y","Label","content","Content","replay","title","description","picUrl","url","uploadMaterial","__dirname","data","type","mediaId","media_id","JSON","stringify","loadMaterial","getMaterialCount","imgData","materail"],"mappings":"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","file":"weixin.js","sourcesContent":["/**\r\n * Created by yao on 2016/11/3.\r\n *\r\n * 这个是主要处理的逻辑层,我们会对返回的内容做对应的处理,最后由wechat的那个逻辑类来返回正确的内容\r\n *\r\n */\r\n\"use strict\";\r\n\r\n\r\nvar config = require('./config');\r\nvar Wechat = require('./wechat/wechat');\r\nvar wechatApi = new Wechat(config.wechat);\r\nexports.wechatApi = new Wechat(config.wechat);\r\nexports.reply = function*(next) {\r\n    var message = this.weixin;\r\n    if (message.MsgType === 'event') {\r\n        if (message.Event === 'subscribe') {\r\n            if (message.EventKey) {\r\n                console.log('扫描二维码进来：' + message.EventKey + '' + message.ticket);\r\n            }\r\n            this.body = '哈哈哈，你订阅了这个号\\r\\n' + '消息ID：';\r\n        } else if (message.Event === 'unsubscribe') {\r\n            console.log('取消关注!');\r\n        }\r\n        else if (message.Event === 'location') {\r\n            this.body = \"您的上报位置是:\" + message.latitude + '/' + message.longitude + '-' + message.Precision;\r\n        } else if (message.Event === 'CLICK') {\r\n            this.body = '您了菜单' + message.EventKey;\r\n        } else if (message.Event === 'scan') {\r\n            console.log('关注后扫二维码' + message.EventKey + '' + message.Ticket);\r\n            this.body = \"看见您扫了一下哦!\";\r\n        } else if (message.Event === 'view') {\r\n            this.body = '您点击了菜单中的链接:' + message.EventKey;\r\n        } else {\r\n            console.log(\"do nothing!\");\r\n        }\r\n    } else if (message.MsgType === 'location') {\r\n        this.body = \"您的上报位置是:\" + message.Location_X + '/' + message.Location_Y + '-' + message.Label;\r\n        console.log(\"do nothing!\");\r\n    } else if (message.MsgType === 'text') {\r\n        var content = message.Content;\r\n        var replay = '额,您说的' + message.Content + '太复杂了,我无法理解';\r\n        if (content === '1') {\r\n            replay = '我是程序员';\r\n        } else if (content === \"黄程\") {\r\n            replay = \"我爱你,老婆!\";\r\n        } else if (content === '4') {\r\n            replay = [{\r\n                title: '技术改变世界!',\r\n                description: '我是程序员',\r\n                picUrl: 'http://cmstest.51yxwz.com/27616_MP/resource/images/20160721174701000592.jpg',\r\n                url: 'https://github.com'\r\n\r\n            }, {\r\n                title: 'Nodejs 开发微信 !',\r\n                description: '我是程序员',\r\n                picUrl: 'http://xfysj-yao.stor.sinaapp.com/ok.jpg',\r\n                url: 'https://nodejs.org/'\r\n\r\n            }];\r\n        } else if (content === '5') {\r\n            var data = yield wechatApi.uploadMaterial('image', __dirname + '/2.jpg');\r\n            replay = {\r\n                type: 'image',\r\n                mediaId: data.media_id\r\n            };\r\n        } else if (content === '51') {\r\n            var data = yield wechatApi.uploadMaterial('newsImg', __dirname + '/2.jpg', {});\r\n            replay = {\r\n                type: 'text',\r\n                content: \"<a href='\" + data.url + \"'>链接</a>\"\r\n            };\r\n        } else if (content === '6') {\r\n            var data = yield wechatApi.uploadMaterial('video', __dirname + '/1.mp4', {\r\n                type: 'video', description: \"{title:'111', introduction:22222}\"\r\n            });\r\n            console.log(\"返回的data是:\" + JSON.stringify(data));\r\n            replay = {\r\n                title: '打球',\r\n                type: 'video',\r\n                description: '没有描述的视频',\r\n                mediaId: data.media_id\r\n            };\r\n        } else if (content === '7') {\r\n            var data = yield wechatApi.uploadMaterial('video', __dirname + '/6.mp4');\r\n            console.log(\"返回的data是:\" + JSON.stringify(data));\r\n            replay = {\r\n                title: '打球',\r\n                type: 'video',\r\n                description: '没有描述的视频',\r\n                mediaId: data.media_id\r\n            };\r\n        } else if (content === '8') {\r\n            var data = yield wechatApi.loadMaterial({});\r\n            console.log(\"返回的data是:\" + JSON.stringify(data));\r\n        } else if (content === 'news') {\r\n            var data = yield wechatApi.loadMaterial({type:'news'});\r\n            console.log(\"返回的data是:\" + JSON.stringify(data));\r\n        } else if (content === '9') {\r\n            var data = yield wechatApi.getMaterialCount();\r\n            console.log(\"返回的data是:\" + JSON.stringify(data));\r\n        } else if (content === '10') {\r\n            var data = yield wechatApi.uploadMaterial('image', __dirname + '/2.jpg', {});\r\n            replay = {\r\n                type: 'image',\r\n                mediaId: data.media_id\r\n            };\r\n        } else if (content === '11') {\r\n            var imgData = yield wechatApi.uploadMaterial('image', __dirname + '/2.jpg', {});\r\n            var materail = {\r\n                \"articles\": [{\r\n                    \"title\": 'test',\r\n                    \"thumb_media_id\": imgData.media_id,\r\n                    \"author\": 'yao',\r\n                    \"digest\": '!!!',\r\n                    \"show_cover_pic\": 1,\r\n                    \"content\": '说点什么',\r\n                    \"content_source_url\": 'http://www.nsw88.com'\r\n                },\r\n                    //若新增的是多图文素材，则此处应有几段articles结构，最多8段\r\n                ]\r\n            }\r\n            var data = yield wechatApi.uploadMaterial('news',materail, {});\r\n                // replay = [{\r\n                //     title: '技术改变世界!',\r\n                //     description: '我是程序员',\r\n                //     picUrl: url.url,\r\n                //     url: 'https://github.com'\r\n                //\r\n                // }];\r\n            console.log(data);\r\n        }\r\n        console.log(\"返回的replay是:\" + JSON.stringify(replay));\r\n        this.body = replay;\r\n    }\r\n\r\n\r\n    yield next;\r\n};\r\n\r\n"]}