{"version":3,"sources":["../../src/common/bas.service.js"],"names":["Shcema","Service","name","schema","DbModal","model","key","hasOwnProperty","item","filter","pageSize","pageNumber","expect","sortter","skipItems","console","log","query","find","skip","limit","updated","sort","findOne","exec","id","Types","ObjectId","_id","findByIdAndUpdate","upsert","toSchema","save","e"],"mappings":";;;;;;;;;AAAA;;;;AAIA;;;;;;;;IAFCA,M,sBAAAA,M;;IAIoBC,O;AACpB,kBAAYC,IAAZ,EAAkBC,MAAlB,EAA0B;AAAA;;AACzB,OAAKA,MAAL,GAAcA,MAAd;AACA,OAAKC,OAAL,GAAe,mBAAQC,KAAR,CAAcH,IAAd,EAAoB,KAAKC,MAAzB,CAAf;AACA;AACD;;;;;;yBAIOG,G,EAAK;AACX,UAAO,KAAKH,MAAL,CAAYI,cAAZ,CAA2BD,GAA3B,CAAP;AACA;;;2BACQE,I,EAAM;AACd,UAAO,IAAI,KAAKJ,OAAT,CAAiBI,IAAjB,CAAP;AACA;AACD;;;;;;;;;0BAMQC,M,EAAOC,Q,EAA2C;AAAA,OAAjCC,UAAiC,uEAApB,CAAoB;AAAA,OAAlBC,MAAkB;AAAA,OAATC,OAAS;;AACzDD,YAAQA,UAAS,EAAjB;AACA,OAAIE,YAAY,CAACH,aAAW,CAAZ,IAAiBD,QAAjC;AACAK,WAAQC,GAAR,CAAYF,SAAZ;AACA,OAAIG,QAAQ,KAAKb,OAAL,CAAac,IAAb,CAAkBT,MAAlB,EAAyBG,MAAzB,CAAZ;AACA,OAAIF,QAAJ,EAAc;AACbO,UAAME,IAAN,CAAWL,SAAX,EAAsBM,KAAtB,CAA4BV,QAA5B;AACA;AACDG,aAAUA,WAAW;AACpBQ,aAAS,CAAC;AADU,IAArB;AAGA,UAAOJ,MAAMK,IAAN,CAAWT,OAAX,CAAP;AACA;AACD;;;;;;0BAGQJ,M,EAAQ;AACf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAO,KAAKL,OAAL,CAAamB,OAAb,CAAqBd,MAArB,EAA6Be,IAA7B,EAAP;AACA;;;8BACWC,E,EAAI;AACf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAO,KAAKrB,OAAL,CAAamB,OAAb,CAAqB;AAC3B,WAAO,mBAAQG,KAAR,CAAcC,QAAd,CAAuBF,EAAvB;AADoB,IAArB,EAEJD,IAFI,EAAP;AAGA;AACD;;;;;;2BAGShB,I,EAAM;AACd,OAAIiB,KAAKjB,KAAKoB,GAAd;AACA,OAAI;AACH,QAAIH,EAAJ,EAAQ;AACP,YAAOjB,KAAKoB,GAAZ;AACA,YAAO,KAAKxB,OAAL,CAAayB,iBAAb,CAA+BJ,EAA/B,EAAmCjB,IAAnC,EAAyC;AAC/CsB,cAAQ;AADuC,MAAzC,CAAP;AAGA,KALD,MAKO;AACN,YAAO,KAAKC,QAAL,CAAcvB,IAAd,EAAoBwB,IAApB,EAAP;AACA;AACD,IATD,CASE,OAAOC,CAAP,EAAU;AACXlB,YAAQC,GAAR,CAAYiB,CAAZ;AACA;AAED;;;2BACQ,CAER;;;;;;kBAtFmBhC,O","file":"bas.service.js","sourcesContent":["import mogoose from \"mongoose\";\r\nvar {\r\n\tShcema\r\n} = mogoose;\r\nimport _ from \"lodash\";\r\n\r\nexport default class Service {\r\n\tconstructor(name, schema) {\r\n\t\tthis.schema = schema;\r\n\t\tthis.DbModal = mogoose.model(name, this.schema)\r\n\t}\r\n\t/**\r\n\t * @param  {} key\r\n\t */\r\n\r\n\thasKey(key) {\r\n\t\treturn this.schema.hasOwnProperty(key);\r\n\t}\r\n\ttoSchema(item) {\r\n\t\treturn new this.DbModal(item);\r\n\t}\r\n\t/**\r\n\t * @param  {String} filter\r\n\t * @param  {Number} pageSize=10\r\n\t * @param  {Number} pageNumber=0\r\n\t * @param  {*} sortter\r\n\t */\r\n\tgetList(filter,pageSize, pageNumber = 1,expect,  sortter) {\r\n\t\texpect =expect ||{};\r\n\t\tvar skipItems = (pageNumber-1) * pageSize;\r\n\t\tconsole.log(skipItems);\r\n\t\tvar query = this.DbModal.find(filter,expect);\r\n\t\tif (pageSize) {\r\n\t\t\tquery.skip(skipItems).limit(pageSize);\r\n\t\t}\r\n\t\tsortter = sortter || {\r\n\t\t\tupdated: -1\r\n\t\t};\r\n\t\treturn query.sort(sortter);\r\n\t}\r\n\t/**\r\n\t * @param  {String} filter\r\n\t */\r\n\tgetItem(filter) {\r\n\t\t// return new Promise((resolve, reject) => {\r\n\t\t// \tthis.DbModal.findOne(filter).exec((err,item)=>{\r\n\t\t// \t\t//console.log(item);\r\n\t\t// \t\tif(err){\r\n\t\t// \t\t\treject('没有找到对应的'+this.name);\r\n\t\t// \t\t}else{\r\n\t\t// \t\t\tresolve(item);\r\n\t\t// \t\t}\r\n\t\t// \t});\r\n\t\t// })\r\n\t\treturn this.DbModal.findOne(filter).exec();\r\n\t}\r\n\tgetItemById(id) {\r\n\t\t// return new Promise((resolve, reject) => {\r\n\t\t// \tthis.DbModal.findOne(filter).exec((err,item)=>{\r\n\t\t// \t\t//console.log(item);\r\n\t\t// \t\tif(err){\r\n\t\t// \t\t\treject('没有找到对应的'+this.name);\r\n\t\t// \t\t}else{\r\n\t\t// \t\t\tresolve(item);\r\n\t\t// \t\t}\r\n\t\t// \t});\r\n\t\t// })\r\n\t\treturn this.DbModal.findOne({\r\n\t\t\t'_id': mogoose.Types.ObjectId(id)\r\n\t\t}).exec();\r\n\t}\r\n\t/**\r\n\t * @param  {Object} item\r\n\t */\r\n\tsaveItem(item) {\r\n\t\tvar id = item._id;\r\n\t\ttry {\r\n\t\t\tif (id) {\r\n\t\t\t\tdelete item._id;\r\n\t\t\t\treturn this.DbModal.findByIdAndUpdate(id, item, {\r\n\t\t\t\t\tupsert: true\r\n\t\t\t\t})\r\n\t\t\t} else {\r\n\t\t\t\treturn this.toSchema(item).save();\r\n\t\t\t}\r\n\t\t} catch (e) {\r\n\t\t\tconsole.log(e);\r\n\t\t}\r\n\r\n\t}\r\n\tcreate() {\r\n\r\n\t}\r\n}"]}