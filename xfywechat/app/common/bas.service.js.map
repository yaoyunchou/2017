{"version":3,"sources":["../../src/common/bas.service.js"],"names":["Shcema","Service","name","schema","DbModal","model","key","hasOwnProperty","item","filter","pageSize","pageNumber","sortter","skipItems","query","find","skip","limit","updated","sort","exec","findOne","id","Types","ObjectId","_id","findByIdAndUpdate","upsert","toSchema","save","e","console","log"],"mappings":";;;;;;;;;AAAA;;;;AAIA;;;;;;;;IAFCA,M,sBAAAA,M;;IAIoBC,O;AACpB,kBAAYC,IAAZ,EAAkBC,MAAlB,EAA0B;AAAA;;AACzB,OAAKA,MAAL,GAAcA,MAAd;AACA,OAAKC,OAAL,GAAe,mBAAQC,KAAR,CAAcH,IAAd,EAAoB,KAAKC,MAAzB,CAAf;AACA;AACD;;;;;;yBAIOG,G,EAAK;AACX,UAAO,KAAKH,MAAL,CAAYI,cAAZ,CAA2BD,GAA3B,CAAP;AACA;;;2BACQE,I,EAAM;AACd,UAAO,IAAI,KAAKJ,OAAT,CAAiBI,IAAjB,CAAP;AACA;AACD;;;;;;;;;0BAMQC,M,EAAQC,Q,EAAUC,U,EAAYC,O,EAAS;AAC9C,OAAIC,YAAYF,aAAaD,QAA7B;AACA,OAAII,QAAQ,KAAKV,OAAL,CAAaW,IAAb,CAAkBN,MAAlB,CAAZ;AACA,OAAIC,QAAJ,EAAc;AACbI,UAAME,IAAN,CAAWH,SAAX,EAAsBI,KAAtB,CAA4BP,QAA5B;AACA;AACDE,aAAUA,WAAW;AACpBM,aAAS,CAAC;AADU,IAArB;AAGA,UAAOJ,MAAMK,IAAN,CAAWP,OAAX,EAAoBQ,IAApB,EAAP;AACA;AACD;;;;;;0BAGQX,M,EAAQ;AACf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAO,KAAKL,OAAL,CAAaiB,OAAb,CAAqBZ,MAArB,EAA6BW,IAA7B,EAAP;AACA;;;8BACWE,E,EAAI;AACf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAO,KAAKlB,OAAL,CAAaiB,OAAb,CAAqB,EAAC,OAAO,mBAAQE,KAAR,CAAcC,QAAd,CAAuBF,EAAvB,CAAR,EAArB,EAA0DF,IAA1D,EAAP;AACA;AACD;;;;;;2BAGSZ,I,EAAM;AACd,OAAIc,KAAKd,KAAKiB,GAAd;AACA,OAAG;AACF,QAAIH,EAAJ,EAAQ;AACR,YAAOd,KAAKiB,GAAZ;AACA,YAAO,KAAKrB,OAAL,CAAasB,iBAAb,CAA+BJ,EAA/B,EAAmCd,IAAnC,EAAyC;AAC/CmB,cAAQ;AADuC,MAAzC,CAAP;AAGA,KALA,MAKM;AACN,YAAO,KAAKC,QAAL,CAAcpB,IAAd,EAAoBqB,IAApB,EAAP;AACA;AACA,IATD,CASC,OAAMC,CAAN,EAAQ;AACRC,YAAQC,GAAR,CAAYF,CAAZ;AACA;AAED;;;2BACQ,CAER;;;;;;kBAlFmB7B,O","file":"bas.service.js","sourcesContent":["import mogoose from \"mongoose\";\r\nvar {\r\n\tShcema\r\n} = mogoose;\r\nimport _ from \"lodash\";\r\n\r\nexport default class Service {\r\n\tconstructor(name, schema) {\r\n\t\tthis.schema = schema;\r\n\t\tthis.DbModal = mogoose.model(name, this.schema)\r\n\t}\r\n\t/**\r\n\t * @param  {} key\r\n\t */\r\n\r\n\thasKey(key) {\r\n\t\treturn this.schema.hasOwnProperty(key);\r\n\t}\r\n\ttoSchema(item) {\r\n\t\treturn new this.DbModal(item);\r\n\t}\r\n\t/**\r\n\t * @param  {String} filter\r\n\t * @param  {Number} pageSize=10\r\n\t * @param  {Number} pageNumber=0\r\n\t * @param  {*} sortter\r\n\t */\r\n\tgetList(filter, pageSize, pageNumber, sortter) {\r\n\t\tvar skipItems = pageNumber * pageSize;\r\n\t\tvar query = this.DbModal.find(filter);\r\n\t\tif (pageSize) {\r\n\t\t\tquery.skip(skipItems).limit(pageSize);\r\n\t\t}\r\n\t\tsortter = sortter || {\r\n\t\t\tupdated: -1\r\n\t\t};\r\n\t\treturn query.sort(sortter).exec();\r\n\t}\r\n\t/**\r\n\t * @param  {String} filter\r\n\t */\r\n\tgetItem(filter) {\r\n\t\t// return new Promise((resolve, reject) => {\r\n\t\t// \tthis.DbModal.findOne(filter).exec((err,item)=>{\r\n\t\t// \t\t//console.log(item);\r\n\t\t// \t\tif(err){\r\n\t\t// \t\t\treject('没有找到对应的'+this.name);\r\n\t\t// \t\t}else{\r\n\t\t// \t\t\tresolve(item);\r\n\t\t// \t\t}\r\n\t\t// \t});\r\n\t\t// })\r\n\t\treturn this.DbModal.findOne(filter).exec();\r\n\t}\r\n\tgetItemById(id) {\r\n\t\t// return new Promise((resolve, reject) => {\r\n\t\t// \tthis.DbModal.findOne(filter).exec((err,item)=>{\r\n\t\t// \t\t//console.log(item);\r\n\t\t// \t\tif(err){\r\n\t\t// \t\t\treject('没有找到对应的'+this.name);\r\n\t\t// \t\t}else{\r\n\t\t// \t\t\tresolve(item);\r\n\t\t// \t\t}\r\n\t\t// \t});\r\n\t\t// })\r\n\t\treturn this.DbModal.findOne({'_id': mogoose.Types.ObjectId(id)}).exec();\r\n\t}\r\n\t/**\r\n\t * @param  {Object} item\r\n\t */\r\n\tsaveItem(item) {\r\n\t\tvar id = item._id;\r\n\t\ttry{\r\n\t\t\tif (id) {\r\n\t\t\tdelete item._id;\r\n\t\t\treturn this.DbModal.findByIdAndUpdate(id, item, {\r\n\t\t\t\tupsert: true\r\n\t\t\t})\r\n\t\t} else {\r\n\t\t\treturn this.toSchema(item).save();\r\n\t\t}\r\n\t\t}catch(e){\r\n\t\t\tconsole.log(e);\r\n\t\t}\r\n\t\t\r\n\t}\r\n\tcreate() {\r\n\r\n\t}\r\n}\r\n"]}