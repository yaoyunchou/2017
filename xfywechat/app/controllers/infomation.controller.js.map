{"version":3,"sources":["../../src/controllers/infomation.controller.js"],"names":["dateFormat","require","InfomationController","id","service","getItemById","infomation","fixhtml","yao","title","link","description","pubDate","created","source","author","typeId","_slef","params","body","pageSize","parseInt","query","pageNumber","sortter","expect","getList","list","backData","isSuccess","data","schedule","rule","RecurrenceRule","dayOfWeek","Range","hour","minute","job","scheduleJob","replace","console","log"],"mappings":";;;;;;;;;;;;;;;AAAA;;AAIA;;;;AACA;;;;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEA,IAAMA,aAAaC,QAAQ,YAAR,CAAnB;;IAIqBC,oB,WAFpB,yBAAY,YAAZ,C,UACA,6CAAuB,aAAvB,C,UAEC,mBAAM,YAAN,C,UAmBA,mBAAM,MAAN,C,UAgBA,mBAAM,cAAN,C;;;;;;;AAnCoB;;;QACAC,E,SAAAA,E;;;;;;;eACG,KAAKC,OAAL,CAAaC,WAAb,CAAyBF,EAAzB,C;;;AAAnBG,kB;;AACJC,gBAAQD,UAAR;AACAA,mBAAWE,GAAX,GAAiB,YAAjB;;yCAEO;AACNC,gBAAOH,WAAWG,KADZ;AAENC,eAAMJ,WAAWI,IAFX;AAGNC,sBAAaL,WAAWK,WAHlB;AAINC,kBAASN,WAAWM,OAJd;AAKNC,kBAASb,WAAWM,WAAWO,OAAtB,EAA+B,qBAA/B,CALH;AAMNC,iBAAQR,WAAWQ,MANb;AAONC,iBAAQT,WAAWS,MAPb;AAQNC,iBAAQV,WAAWU,MARb;AASNC,gBAAMX;;AATA,S;;;;;;;;;;;;;;;;;;;8EAcMY,M,EAAOC,I;;;;;;AAChBC,gB,GAAWC,SAASF,KAAKG,KAAL,CAAWF,QAApB,KAAgC,E;AAC3CG,kB,GAAaF,SAASF,KAAKG,KAAL,CAAWC,UAApB,KAAiC,C;AAC9CC,e,GAAU,EAAE,WAAU,CAAC,CAAb,E;AACVC,c,GAAUN,KAAKG,KAAL,CAAWG,MAAX,IAAmB,E;;eACf,KAAKrB,OAAL,CAAasB,OAAb,CAAqB,EAArB,EAAwBN,QAAxB,EAAiCG,UAAjC,EAA4CE,MAA5C,EAAmDD,OAAnD,C;;;AAAdG,Y;AAGAC,gB,GAAW;AACdC,oBAAU,IADI;AAEdC,eAAKH;AAFS,S;0CAKRC,Q;;;;;;;;;;;;;;;;;;;8EAGWV,M,EAAOC,I;;;;;AACzB,mCAAgBA,KAAKG,KAAL,CAAWZ,IAA3B,EAAgC,CAAhC,EAAkC,KAAKN,OAAvC;AACA;;;;;;;;;;;;;;;;;;;;;AAIF;;kBA3CqBF,oB;AA4CrB,IAAI6B,WAAW9B,QAAQ,eAAR,CAAf;AACA,IAAI+B,OAAO,IAAID,SAASE,cAAb,EAAX;;AAEED,KAAKE,SAAL,GAAiB,CAAC,CAAD,EAAI,IAAIH,SAASI,KAAb,CAAmB,CAAnB,EAAsB,CAAtB,CAAJ,CAAjB;;AAEAH,KAAKI,IAAL,GAAY,CAAZ;;AAEAJ,KAAKK,MAAL,GAAc,EAAd;;AAEA,IAAIC,MAAMP,SAASQ,WAAT,CAAqBP,IAArB,EAA2B,YAAU;AAC9C,4BAAgB,gCAAhB,EAAkD,CAAlD,EAAoD,0BAApD;AACA,CAFS,CAAV;;AAIF,SAASzB,OAAT,CAAiBuB,IAAjB,EAAsB;AACrBA,MAAKnB,WAAL,CAAiB6B,OAAjB,CAAyB,MAAzB,EAAgC,OAAhC;AACAC,SAAQC,GAAR,CAAYZ,KAAKnB,WAAjB;AACA","file":"infomation.controller.js","sourcesContent":["import {\r\n\troutePrefix,\r\n\troute\r\n} from '../router';\r\nimport InfomationSvc from '../services/infomation.service'\r\nimport Service from '../common/service.decorator'\r\nimport {fetchInfomation} from '../libs/util'\r\n\r\nconst dateFormat = require('dateformat');\r\n\r\n@routePrefix('infomation')\r\n@Service(InfomationSvc, 'infomations')\r\nexport default class InfomationController{\r\n\t@route('detail/:id') // http://localhost:3000/user\r\n\tasync getInfomation({id}) {\r\n\t\tlet infomation = await this.service.getItemById(id);\r\n\t\tfixhtml(infomation);\r\n\t\tinfomation.yao = 'yaoyunchou';\r\n\t\t\r\n\t\treturn {\r\n\t\t\ttitle: infomation.title,\r\n\t\t\tlink: infomation.link,\r\n\t\t\tdescription: infomation.description,\r\n\t\t\tpubDate: infomation.pubDate,\r\n\t\t\tcreated: dateFormat(infomation.created ,\"yyyy-mm-dd HH:mm:ss\"),\r\n\t\t\tsource: infomation.source,\r\n\t\t\tauthor: infomation.author,\r\n\t\t\ttypeId: infomation.typeId,\r\n\t\t\t_slef:infomation\r\n\r\n\t\t};\r\n\t}\r\n\t@route('list')\r\n\tasync getList(params,body) {\r\n\t\tlet pageSize = parseInt(body.query.pageSize) ||10;\r\n\t\tlet pageNumber = parseInt(body.query.pageNumber)||1;\r\n\t\tlet sortter = { \"pubDate\":-1};\r\n\t\tlet expect =  body.query.expect||{};\r\n\t\tlet list =  await this.service.getList({},pageSize,pageNumber,expect,sortter);\r\n\t\r\n\t\t\r\n\t\tlet backData = {\r\n\t\t\tisSuccess:true,\r\n\t\t\tdata:list\r\n\t\t};\r\n\r\n\t\treturn backData;\r\n\t}\r\n\t@route('addRssByLink')\r\n\tasync addRssByLink(params,body){\r\n\t\tfetchInfomation(body.query.link,2,this.service)\r\n\t\t//return backData;\r\n\t}\r\n}\r\n\r\n//fetchInfomation('http://www.w3cplus.com/rss.xml', 1,new InfomationSvc());\r\nvar schedule = require(\"node-schedule\");\r\nvar rule = new schedule.RecurrenceRule();\r\n\r\n　　rule.dayOfWeek = [0, new schedule.Range(1, 6)];\r\n\r\n　　rule.hour = 1;\r\n\r\n　　rule.minute = 55;\r\n\r\n　　var job = schedule.scheduleJob(rule, function(){\r\n　　　fetchInfomation('http://www.w3cplus.com/rss.xml', 1,new InfomationSvc());\r\n　　});\r\n\r\nfunction fixhtml(data){\r\n\tdata.description.replace(/pre/g,\"<div>\");\r\n\tconsole.log(data.description);\r\n}"]}