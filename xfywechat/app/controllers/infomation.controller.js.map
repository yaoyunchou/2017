{"version":3,"sources":["../../src/controllers/infomation.controller.js"],"names":["InfomationController","id","service","getItemById","infomation","fixhtml","create","params","body","pageSize","parseInt","query","pageNumber","sortter","expect","getList","list","count","total","backData","isSuccess","data","link","ture","saveItem","request","schedule","require","rule","RecurrenceRule","dayOfWeek","Range","hour","minute","job","scheduleJob","description","replace","console","log"],"mappings":";;;;;;;;;;;;;;;AAAA;;AAIA;;;;AACA;;;;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAMqBA,oB,WAFpB,yBAAY,YAAZ,C,UACA,6CAAuB,aAAvB,C,UAEC,mBAAM,YAAN,C,UAOA,mBAAM,QAAN,EAAe,KAAf,C,UAMA,mBAAM,MAAN,C,UAgBA,mBAAM,cAAN,C,UAUA,mBAAM,gBAAN,EAAuB,MAAvB,C;;;;;;;AAvCoB;;;QACAC,E,SAAAA,E;;;;;;;eACG,KAAKC,OAAL,CAAaC,WAAb,CAAyBF,EAAzB,C;;;AAAnBG,kB;;AACJC,gBAAQD,UAAR;;yCAEOA,U;;;;;;;;;;;;;;;;;;AAEe;0CACC;AAAA,OAALH,EAAK,SAALA,EAAK;;AACvB,OAAIG,aAAa,KAAKF,OAAL,CAAaI,MAAb,EAAjB;AACA;AACA,UAAOF,UAAP;AACA;;;;4FAEaG,M,EAAOC,I;;;;;;AAChBC,gB,GAAWC,SAASF,KAAKG,KAAL,CAAWF,QAApB,KAAgC,E;AAC3CG,kB,GAAaF,SAASF,KAAKG,KAAL,CAAWC,UAApB,KAAiC,C;AAC9CC,e,GAAU,EAAE,WAAU,CAAC,CAAb,E;AACVC,c,GAAUN,KAAKG,KAAL,CAAWG,MAAX,IAAmB,E;;eAChB,KAAKZ,OAAL,CAAaa,OAAb,CAAqB,EAArB,EAAwBN,QAAxB,EAAiCG,UAAjC,EAA4CE,MAA5C,EAAmDD,OAAnD,C;;;AAAbG,Y;;eACc,KAAKd,OAAL,CAAae,KAAb,CAAmB,EAAnB,C;;;AAAdC,a;AACAC,gB,GAAW;AACdC,oBAAU,IADI;AAEdF,gBAAMA,KAFQ;AAGdG,eAAKL;AAHS,S;0CAMRG,Q;;;;;;;;;;;;;;;;;;;4FAGWZ,M,EAAOC,I;;;;;;;AAExB,mCAAgBA,KAAKG,KAAL,CAAWW,IAA3B,EAAgC,CAAhC,EAAkC,KAAKpB,OAAvC;0CACO,EAACkB,WAAUG,IAAX,EAAgBF,MAAK,OAArB,E;;;;;0CAEA,EAACD,WAAU,KAAX,EAAiBC,kBAAjB,E;;;;;;;;;;;;;;;;;;;4FAKYd,M,EAAOC,I;;;;;;;;eAEH,KAAKN,OAAL,CAAasB,QAAb,CAAsBhB,KAAKiB,OAAL,CAAajB,IAAnC,C;;;AAAnBJ,kB;0CACG,EAACgB,WAAU,IAAX,EAAgBC,MAAK,OAArB,E;;;;;0CAEA,EAACD,WAAU,KAAX,EAAiBC,kBAAjB,E;;;;;;;;;;;;;;;;;;;;;AAMV;;kBApDqBrB,oB;AAqDrB,IAAI0B,WAAWC,QAAQ,eAAR,CAAf;AACA,IAAIC,OAAO,IAAIF,SAASG,cAAb,EAAX;;AAEED,KAAKE,SAAL,GAAiB,CAAC,CAAD,EAAI,IAAIJ,SAASK,KAAb,CAAmB,CAAnB,EAAsB,CAAtB,CAAJ,CAAjB;;AAEAH,KAAKI,IAAL,GAAY,CAAZ;;AAEAJ,KAAKK,MAAL,GAAc,EAAd;;AAEA,IAAIC,MAAMR,SAASS,WAAT,CAAqBP,IAArB,EAA2B,YAAU;AAC9C,4BAAgB,gCAAhB,EAAkD,CAAlD,EAAoD,0BAApD;AACA,CAFS,CAAV;;AAIF,SAASvB,OAAT,CAAiBgB,IAAjB,EAAsB;AACrBA,MAAKe,WAAL,CAAiBC,OAAjB,CAAyB,MAAzB,EAAgC,OAAhC;AACAC,SAAQC,GAAR,CAAYlB,KAAKe,WAAjB;AACA","file":"infomation.controller.js","sourcesContent":["import {\n\troutePrefix,\n\troute\n} from '../router';\nimport InfomationSvc from '../services/infomation.service'\nimport Service from '../common/service.decorator'\nimport {fetchInfomation} from '../libs/util'\n\n\n\n@routePrefix('infomation')\n@Service(InfomationSvc, 'infomations')\nexport default class InfomationController{\n\t@route('detail/:id') // http://localhost:3000/user\n\tasync getInfomation({id}) {\n\t\tlet infomation = await this.service.getItemById(id);\n\t\tfixhtml(infomation);\n\t\t\n\t\treturn infomation;\n\t}\n\t@route('create','get') // http://localhost:3000/user\n\t createInfomation({id}) {\n\t\tlet infomation = this.service.create();\n\t\t//fixhtml(infomation);\n\t\treturn infomation;\n\t}\n\t@route('list')\n\tasync getList(params,body) {\n\t\tlet pageSize = parseInt(body.query.pageSize) ||10;\n\t\tlet pageNumber = parseInt(body.query.pageNumber)||1;\n\t\tlet sortter = { \"pubDate\":-1};\n\t\tlet expect =  body.query.expect||{};\n\t\tlet list = await this.service.getList({},pageSize,pageNumber,expect,sortter);\n\t\tlet total = await this.service.count({});\n\t\tlet backData = {\n\t\t\tisSuccess:true,\n\t\t\ttotal:total,\n\t\t\tdata:list\n\t\t};\n\n\t\treturn backData;\n\t}\n\t@route('addRssByLink')\n\tasync addRssByLink(params,body){\n\t\ttry {\n\t\t\tfetchInfomation(body.query.link,2,this.service)\n\t\t\treturn {isSuccess:ture,data:'添加成功！'};\n\t\t} catch (error) {\n\t\t\treturn {isSuccess:false,data:error};\n\t\t}\n\t\t\n\t}\n\t@route('saveInfoMation','post')\n\tasync saveInfoMation(params,body){\n\t\ttry {\n\t\t\tlet infomation = await this.service.saveItem(body.request.body);\n\t\t\treturn {isSuccess:true,data:'添加成功！'};\n\t\t} catch (error) {\n\t\t\treturn {isSuccess:false,data:error};\n\t\t}\n\t\t\n\t}\n}\n\n//fetchInfomation('http://www.w3cplus.com/rss.xml', 1,new InfomationSvc());\nvar schedule = require(\"node-schedule\");\nvar rule = new schedule.RecurrenceRule();\n\n　　rule.dayOfWeek = [0, new schedule.Range(1, 6)];\n\n　　rule.hour = 1;\n\n　　rule.minute = 55;\n\n　　var job = schedule.scheduleJob(rule, function(){\n　　　fetchInfomation('http://www.w3cplus.com/rss.xml', 1,new InfomationSvc());\n　　});\n\nfunction fixhtml(data){\n\tdata.description.replace(/pre/g,\"<div>\");\n\tconsole.log(data.description);\n}"]}